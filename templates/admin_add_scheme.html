<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{{ 'Edit' if scheme else 'Add' }} Scheme | Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    :root { --green:#2e7d32; --green-dark:#1b5e20; }
    body { background:#f0f4f0; font-family:'Segoe UI',sans-serif; }
    .sidebar { width:260px; min-height:100vh; background:linear-gradient(180deg,#1b5e20,#2e7d32); position:fixed; top:0; left:0; z-index:100; padding-top:20px; }
    .sidebar-logo { padding:20px; text-align:center; border-bottom:1px solid rgba(255,255,255,0.15); }
    .sidebar-logo h5 { color:white; font-weight:700; margin:8px 0 0; }
    .sidebar-nav a { display:flex; align-items:center; gap:10px; padding:12px 20px; color:rgba(255,255,255,0.85); text-decoration:none; transition:all 0.2s; font-size:0.95rem; }
    .sidebar-nav a:hover,.sidebar-nav a.active { background:rgba(255,255,255,0.15); color:white; padding-left:28px; }
    .sidebar-nav a i { width:20px; }
    .main-content { margin-left:260px; padding:25px; }
    .form-card { background:white; border-radius:16px; box-shadow:0 2px 10px rgba(0,0,0,0.06); overflow:hidden; }
    .form-card-header { background:linear-gradient(135deg,#2e7d32,#66bb6a); color:white; padding:20px 25px; }
    .form-card-body { padding:30px; }
    .form-control:focus,.form-select:focus { border-color:#2e7d32; box-shadow:0 0 0 3px rgba(46,125,50,0.12); }
    .form-label { font-weight:600; font-size:0.9rem; color:#444; }
    .required-mark { color:#e53935; }
    .section-title { font-size:0.8rem; font-weight:700; text-transform:uppercase; letter-spacing:1px; color:#666; border-bottom:2px solid #e8f5e9; padding-bottom:6px; margin-bottom:16px; }
    .btn-save { background:linear-gradient(135deg,#2e7d32,#66bb6a); border:none; border-radius:30px; padding:12px 35px; font-weight:700; color:white; transition:all 0.2s; }
    .btn-save:hover { background:linear-gradient(135deg,#1b5e20,#2e7d32); color:white; transform:translateY(-2px); }
    textarea { resize:vertical; min-height:80px; }
    .tip-text { font-size:0.78rem; color:#888; margin-top:4px; }
    @media(max-width:768px) { .sidebar{display:none;} .main-content{margin-left:0;} }
  </style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <div class="sidebar-logo">
    <div style="font-size:2rem;">üåæ</div>
    <h5>Kisan Sahayata</h5>
    <small style="color:rgba(255,255,255,0.6);">Admin Panel</small>
  </div>
  <nav class="sidebar-nav">
    <a href="{{ url_for('admin_dashboard') }}"><i class="fas fa-tachometer-alt"></i>Dashboard</a>
    <a href="{{ url_for('admin_add_scheme') }}" class="active"><i class="fas fa-plus-circle"></i>Add Scheme</a>
    <a href="{{ url_for('govscheme') }}" target="_blank"><i class="fas fa-eye"></i>Farmer Portal</a>
    <hr style="border-color:rgba(255,255,255,0.2);margin:10px 20px;">
    <a href="{{ url_for('admin_logout') }}" style="color:rgba(255,100,100,0.9);">
      <i class="fas fa-sign-out-alt"></i>Logout
    </a>
  </nav>
</div>

<div class="main-content">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h4 class="fw-bold mb-0">{{ '‚úèÔ∏è Edit Scheme' if scheme else '‚ûï Add New Scheme' }}</h4>
      <small class="text-muted">{{ 'Update scheme details' if scheme else 'Add a new scheme to the database' }}</small>
    </div>
    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-secondary rounded-pill btn-sm">
      <i class="fas fa-arrow-left me-1"></i>Back
    </a>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% for category, message in messages %}
      <div class="alert alert-{{ 'success' if category=='success' else 'danger' }} rounded-3 alert-dismissible fade show">
        {{ message }}<button class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endwith %}

  <form method="POST" action="{{ url_for('admin_edit_scheme', sid=scheme.id) if scheme else url_for('admin_add_scheme') }}">

    <div class="form-card mb-4">
      <div class="form-card-header">
        <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Basic Information</h5>
      </div>
      <div class="form-card-body">
        <div class="row g-3">
          <div class="col-md-8">
            <label class="form-label">Scheme Title <span class="required-mark">*</span></label>
            <input type="text" name="title" class="form-control" placeholder="e.g. PM-KISAN Samman Nidhi"
                   value="{{ scheme.title if scheme else '' }}" required>
          </div>
          <div class="col-md-4">
            <label class="form-label">Status <span class="required-mark">*</span></label>
            <select name="status" class="form-select" required>
              <option value="active" {{ 'selected' if not scheme or scheme.status=='active' }}>‚úÖ Active</option>
              <option value="inactive" {{ 'selected' if scheme and scheme.status=='inactive' }}>‚ùå Inactive</option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label">Category <span class="required-mark">*</span></label>
            <select name="category" class="form-select" required>
              <option value="" disabled {{ 'selected' if not scheme }}>-- Select Category --</option>
              <option value="govt" {{ 'selected' if scheme and scheme.category=='govt' }}>üìã Government</option>
              <option value="financial" {{ 'selected' if scheme and scheme.category=='financial' }}>üí∞ Financial</option>
              <option value="insurance" {{ 'selected' if scheme and scheme.category=='insurance' }}>üõ°Ô∏è Insurance</option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label">Scheme Type <span class="required-mark">*</span></label>
            <select name="scheme_type" class="form-select" required>
              <option value="Central" {{ 'selected' if not scheme or scheme.scheme_type=='Central' }}>üáÆüá≥ Central</option>
              <option value="Maharashtra" {{ 'selected' if scheme and scheme.scheme_type=='Maharashtra' }}>üü† Maharashtra</option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label">Official Website</label>
            <input type="url" name="official_url" class="form-control" placeholder="https://..."
                   value="{{ scheme.official_url if scheme else '' }}">
          </div>
        </div>
      </div>
    </div>

    <div class="form-card mb-4">
      <div class="form-card-header">
        <h5 class="mb-0"><i class="fas fa-align-left me-2"></i>Scheme Details</h5>
      </div>
      <div class="form-card-body">
        <div class="row g-3">
          <div class="col-12">
            <label class="form-label">Description <span class="required-mark">*</span></label>
            <textarea name="description" class="form-control" rows="3" required
                      placeholder="Describe the scheme...">{{ scheme.description if scheme else '' }}</textarea>
          </div>
          <div class="col-md-6">
            <label class="form-label">Eligibility</label>
            <textarea name="eligibility" class="form-control" rows="2"
                      placeholder="Who can apply?">{{ scheme.eligibility if scheme else '' }}</textarea>
          </div>
          <div class="col-md-6">
            <label class="form-label">Benefits</label>
            <textarea name="benefits" class="form-control" rows="2"
                      placeholder="What benefits does the farmer get?">{{ scheme.benefits if scheme else '' }}</textarea>
          </div>
          <div class="col-12">
            <label class="form-label">How to Apply</label>
            <textarea name="how_to_apply" class="form-control" rows="3"
                      placeholder="Step-by-step application process...">{{ scheme.how_to_apply if scheme else '' }}</textarea>
          </div>
        </div>
      </div>
    </div>

    <div class="form-card mb-4">
      <div class="form-card-header">
        <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>Documents & FAQs</h5>
      </div>
      <div class="form-card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Documents Required</label>
            <textarea name="documents" class="form-control" rows="5"
                      placeholder="One document per line:&#10;Aadhar Card&#10;Bank Passbook&#10;Land Records">{{ docs_text if docs_text else '' }}</textarea>
            <p class="tip-text">üí° Enter one document per line</p>
          </div>
          <div class="col-md-6">
            <label class="form-label">FAQs / Important Notes</label>
            <textarea name="faqs" class="form-control" rows="5"
                      placeholder="One FAQ/note per line:&#10;Only landholding farmers eligible&#10;Payments every 4 months">{{ faqs_text if faqs_text else '' }}</textarea>
            <p class="tip-text">üí° Enter one FAQ/note per line</p>
          </div>
        </div>
      </div>
    </div>

    <div class="form-card mb-4">
      <div class="form-card-header">
        <h5 class="mb-0"><i class="fas fa-calendar me-2"></i>Dates & Contact</h5>
      </div>
      <div class="form-card-body">
        <div class="row g-3">
          <div class="col-md-3">
            <label class="form-label">Start Date</label>
            <input type="text" name="start_date" class="form-control" placeholder="dd-mm-yyyy"
                   value="{{ scheme.start_date if scheme else '' }}">
          </div>
          <div class="col-md-3">
            <label class="form-label">End Date</label>
            <input type="text" name="end_date" class="form-control" placeholder="dd-mm-yyyy or Ongoing"
                   value="{{ scheme.end_date if scheme else '' }}">
          </div>
          <div class="col-md-3">
            <label class="form-label">Deadline</label>
            <input type="text" name="deadline" class="form-control" placeholder="e.g. 31-03-2026 or Ongoing"
                   value="{{ scheme.deadline if scheme else '' }}">
          </div>
          <div class="col-md-3">
            <label class="form-label">Helpline Number</label>
            <input type="text" name="phone" class="form-control" placeholder="e.g. 1800-XXX-XXXX"
                   value="{{ scheme.phone if scheme else '' }}">
          </div>
          <div class="col-12">
            <label class="form-label">Tags (for chatbot search)</label>
            <input type="text" name="tags" class="form-control" placeholder="e.g. pm kisan, income support, small farmer, central"
                   value="{{ scheme.tags if scheme else '' }}">
            <p class="tip-text">üí° Comma-separated keywords that help chatbot find this scheme</p>
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex gap-3 justify-content-end">
      <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-secondary rounded-pill px-4">Cancel</a>
      <button type="submit" class="btn-save btn">
        <i class="fas fa-save me-2"></i>{{ 'Update Scheme' if scheme else 'Save Scheme' }}
      </button>
    </div>
  </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
