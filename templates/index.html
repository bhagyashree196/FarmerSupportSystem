{% extends "base.html" %}
{% block title %}Kisan Sahayata - Farmer Support Portal{% endblock %}

{% block navbar %}
<nav class="navbar navbar-expand-lg navbar-dark bg-success sticky-top py-2">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="/">
      <img src="{{ url_for('static', filename='images/logo2.jpeg') }}" class="rounded-circle me-2" width="40"
        height="40" alt="Kisan Sahayata Logo"
        onerror="this.src='https://via.placeholder.com/40x40/2e7d32/ffffff?text=KS'">
      <span class="fw-bold fs-4">Kisan Sahayata</span>
    </a>
    <div class="d-flex align-items-center gap-2">
      <select id="languageSwitcher" class="form-select form-select-sm bg-light border-0"
        style="width:120px; border-radius:20px;">
        <option value="en">ğŸ‡¬ğŸ‡§ English</option>
        <option value="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤‚à¤¦à¥€</option>
        <option value="mr">ğŸ‡®ğŸ‡³ à¤®à¤°à¤¾à¤ à¥€</option>
      </select>
      <a href="{{ url_for('admin_login') }}" class="btn btn-outline-light btn-sm px-3" style="border-radius:20px;">
        <i class="fas fa-lock me-1"></i>Admin
      </a>
    </div>
  </div>
</nav>
{% endblock %}

{% block content %}

<!-- HERO -->
<section class="hero-section">
  <div class="container text-center">
    <h1 id="welcomeText" class="hero-title">
      <img src="../static/images/logo2.jpeg" alt="Kisan Sahayata Logo" class="hero-logo">
      Kisan Sahayata
    </h1>
    <p class="hero-subtitle" id="heroSubtitle">Empowering Farmers with Government Schemes & Financial Support</p>
    <div class="row justify-content-center mt-4"></div>
  </div>
</section>

<!-- STATS -->
<div class="container stats-section">
  <div class="row g-3 text-center" id="statsRow">
    <div class="col">
      <div class="stat-card"><i class="fas fa-file-alt stat-icon"></i>
        <div class="stat-number" id="statTotal">--</div>
        <div class="stat-label">Total Schemes</div>
      </div>
    </div>
    <div class="col">
      <div class="stat-card"><i class="fas fa-landmark stat-icon"></i>
        <div class="stat-number" id="statGovt">--</div>
        <div class="stat-label">Govt Schemes</div>
      </div>
    </div>
    <div class="col">
      <div class="stat-card"><i class="fas fa-coins stat-icon"></i>
        <div class="stat-number" id="statFin">--</div>
        <div class="stat-label">Financial</div>
      </div>
    </div>
    <div class="col">
      <div class="stat-card"><i class="fas fa-shield-alt stat-icon"></i>
        <div class="stat-number" id="statIns">--</div>
        <div class="stat-label">Insurance</div>
      </div>
    </div>
    <div class="col">
      <div class="stat-card"><i class="fas fa-check-circle stat-icon"></i>
        <div class="stat-number" id="statActive">--</div>
        <div class="stat-label">Active</div>
      </div>
    </div>
  </div>
</div>

<!-- FEATURE CARDS -->
<div class="container mt-5">
  <div class="row g-4">
    <div class="col-md-4">
      <a href="javascript:void(0)" class="feature-card" data-bs-toggle="modal" data-bs-target="#schemeModal">
        <div class="feature-icon"><i class="fas fa-landmark"></i></div>
        <h3>ğŸ“‹ Government Schemes</h3>
        <p>Explore PM-KISAN, RKVY, Maharashtra state schemes and more with eligibility and application details.</p>
        <span class="badge bg-success">Central</span>
        <span class="badge bg-primary">Maharashtra</span>
      </a>
    </div>
    <div class="col-md-4">
      <a href="javascript:void(0)" class="feature-card" data-bs-toggle="modal" data-bs-target="#financialModal">
        <div class="feature-icon"><i class="fas fa-coins"></i></div>
        <h3>ğŸ’° Financial Support</h3>
        <p>Discover KCC loans, PM-KMY pension, AIF infrastructure fund and subsidy programs at low interest.</p>
        <span class="badge bg-success">Loans</span>
        <span class="badge bg-primary">Subsidies</span>
      </a>
    </div>
    <div class="col-md-4">
      <a href="javascript:void(0)" class="feature-card" data-bs-toggle="modal" data-bs-target="#insuranceModal">
        <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
        <h3>ğŸ›¡ï¸ Insurance</h3>
        <p>Get PMFBY crop insurance, life insurance and relief schemes to protect against unexpected losses.</p>
        <span class="badge bg-success">Crop</span>
        <span class="badge bg-primary">Life</span>
      </a>
    </div>
  </div>
</div>

<!-- QUICK LINKS -->
<div class="container quick-links mt-5">
  <h2 class="section-title text-center mb-4">âš¡ Quick Access</h2>
  <div class="row g-3">
    <div class="col-md-6">
      <a href="{{ url_for('govscheme') }}" class="link-card">
        <i class="fas fa-seedling link-icon text-success"></i>
        <div class="link-content">
          <h5>PM-KISAN Scheme</h5>
          <p class="text-muted mb-0">Direct income support of â‚¹6000/year</p>
        </div>
        <i class="fas fa-chevron-right ms-auto text-muted"></i>
      </a>
    </div>
    <div class="col-md-6">
      <a href="{{ url_for('insurance') }}" class="link-card">
        <i class="fas fa-umbrella link-icon text-primary"></i>
        <div class="link-content">
          <h5>Crop Insurance (PMFBY)</h5>
          <p class="text-muted mb-0">Protect your crops against losses</p>
        </div>
        <i class="fas fa-chevron-right ms-auto text-muted"></i>
      </a>
    </div>
    <div class="col-md-6">
      <a href="{{ url_for('financial') }}" class="link-card">
        <i class="fas fa-credit-card link-icon text-warning"></i>
        <div class="link-content">
          <h5>Kisan Credit Card</h5>
          <p class="text-muted mb-0">Easy loans at 4% interest</p>
        </div>
        <i class="fas fa-chevron-right ms-auto text-muted"></i>
      </a>
    </div>
    <div class="col-md-6">
      <a href="{{ url_for('govscheme') }}" class="link-card">
        <i class="fas fa-water link-icon text-info"></i>
        <div class="link-content">
          <h5>Irrigation Schemes</h5>
          <p class="text-muted mb-0">Subsidy for drip/sprinkler systems</p>
        </div>
        <i class="fas fa-chevron-right ms-auto text-muted"></i>
      </a>
    </div>
  </div>
</div>

<!-- TESTIMONIALS -->
<div class="container mb-5 mt-5">
  <h2 class="section-title text-center mb-4">ğŸ˜Š Happy Farmers</h2>
  <div class="row g-4">
    <div class="col-md-4">
      <div class="card testimonial-card h-100 border-0 shadow-sm">
        <div class="card-body text-center">
          <img src="https://randomuser.me/api/portraits/men/32.jpg" class="rounded-circle mb-3" width="80" height="80" alt="Ram Singh">
          <h5>Ram Singh</h5>
          <p class="text-muted">"Got PM-KISAN benefits easily through this portal"</p>
          <div class="text-warning">â˜…â˜…â˜…â˜…â˜…</div>
          <small class="text-success">Farmer, Jalna</small>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card testimonial-card h-100 border-0 shadow-sm">
        <div class="card-body text-center">
          <img src="https://randomuser.me/api/portraits/women/44.jpg" class="rounded-circle mb-3" width="80" height="80" alt="Shanta Bai">
          <h5>Shanta Bai</h5>
          <p class="text-muted">"Understood KCC loan process in my language"</p>
          <div class="text-warning">â˜…â˜…â˜…â˜…â˜…</div>
          <small class="text-success">Farmer, Nashik</small>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card testimonial-card h-100 border-0 shadow-sm">
        <div class="card-body text-center">
          <img src="https://randomuser.me/api/portraits/men/46.jpg" class="rounded-circle mb-3" width="80" height="80" alt="Rajesh Patil">
          <h5>Rajesh Patil</h5>
          <p class="text-muted">"Applied for PMFBY crop insurance in Marathi, very helpful!"</p>
          <div class="text-warning">â˜…â˜…â˜…â˜…â˜…</div>
          <small class="text-success">Farmer, Sangli</small>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODAL 1 â€“ GOVERNMENT SCHEMES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal fade" id="schemeModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">
      <div class="modal-header text-white rounded-top-4"
        style="background:linear-gradient(135deg, #6eac72, #377c39);">
        <div>
          <h5 class="modal-title fw-bold mb-0">ğŸ“‹ Government Schemes</h5>
          <small class="opacity-75">Find the right government scheme for you</small>
        </div>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-4">
        <form id="schemeForm" novalidate>
          <div class="row g-3">

            <!-- NAME -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">
                <i class="fas fa-user text-success me-1"></i>Farmer Name <span class="text-danger">*</span>
              </label>
              <input type="text" class="form-control rounded-3" id="farmerName" placeholder="Enter your name">
              <div class="invalid-feedback"></div>
              <div class="valid-feedback">Looks good! âœ“</div>
            </div>

            <!-- LOCATION -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">
                <i class="fas fa-map-marker-alt text-success me-1"></i>District / Village <span class="text-danger">*</span>
              </label>
              <input type="text" class="form-control rounded-3" id="farmerLocation" placeholder="e.g. Pune, Nashik">
              <div class="invalid-feedback"></div>
              <div class="valid-feedback">Looks good! âœ“</div>
            </div>

            <div class="col-md-6">
              <label class="form-label fw-semibold"><i class="fas fa-flag text-success me-1"></i>Scheme Type <span class="text-danger">*</span></label>
              <select class="form-select rounded-3" id="schemeType" required>
                <option value="All">ğŸŒ All Schemes</option>
                <option value="Central">ğŸ‡®ğŸ‡³ Central Government</option>
                <option value="Maharashtra">ğŸŸ  Maharashtra State</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold"><i class="fas fa-tractor text-success me-1"></i>Farmer Type</label>
              <select class="form-select rounded-3" id="schemefarmerType">
                <option value="">All Farmer Types</option>
                <option value="small">Small Farmer (&lt; 2 Hectare)</option>
                <option value="marginal">Marginal Farmer (&lt; 1 Hectare)</option>
                <option value="large">Large Farmer (&gt; 2 Hectare)</option>
                <option value="sharecropper">Sharecropper / Tenant Farmer</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold"><i class="fas fa-seedling text-success me-1"></i>Crop / Need</label>
              <select class="form-select rounded-3" id="schemeCropNeed">
                <option value="">Any Crop / Need</option>
                <option value="kharif">Kharif Crops (Rice, Cotton, Soybean)</option>
                <option value="rabi">Rabi Crops (Wheat, Gram)</option>
                <option value="irrigation">Irrigation / Water</option>
                <option value="income">Income Support</option>
                <option value="loan_waiver">Loan Waiver</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold"><i class="fas fa-layer-group text-success me-1"></i>Land Holding</label>
              <select class="form-select rounded-3" id="schemeLand">
                <option value="">Any Land Size</option>
                <option value="below1">Below 1 Hectare</option>
                <option value="1to2">1 â€“ 2 Hectare</option>
                <option value="above2">Above 2 Hectare</option>
              </select>
            </div>
          </div>
          <div class="d-grid mt-4">
            <button type="submit" class="btn btn-success fw-bold py-2 rounded-pill fs-6">
              ğŸ” Find Government Schemes <i class="fas fa-arrow-right ms-1"></i>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODAL 2 â€“ FINANCIAL SUPPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal fade" id="financialModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">
      <div class="modal-header text-white rounded-top-4" style="background:linear-gradient(135deg, #6eac72, #377c39);">
        <div>
          <h5 class="modal-title fw-bold mb-0">ğŸ’° Financial Support</h5>
          <small class="opacity-75">Loans, subsidies & financial assistance</small>
        </div>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-4">
        <form id="financialForm" novalidate>
          <div class="row g-3">

            <!-- NAME -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">
                <i class="fas fa-user text-success me-1"></i>Farmer Name <span class="text-danger">*</span>
              </label>
              <input type="text" class="form-control rounded-3" id="financialFarmerName" placeholder="Enter your name">
              <div class="invalid-feedback"></div>
              <div class="valid-feedback">Looks good! âœ“</div>
            </div>

            <!-- LOCATION -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">
                <i class="fas fa-map-marker-alt text-success me-1"></i>District <span class="text-danger">*</span>
              </label>
              <input type="text" class="form-control rounded-3" id="financialLocation" placeholder="e.g. Pune, Nagpur">
              <div class="invalid-feedback"></div>
              <div class="valid-feedback">Looks good! âœ“</div>
            </div>

            <div class="col-md-6">
              <label class="form-label fw-semibold"><i class="fas fa-flag text-success me-1"></i>Scheme Type <span class="text-danger">*</span></label>
              <select class="form-select rounded-3" id="financialType" required>
                <option value="All">ğŸŒ All Schemes</option>
                <option value="Central">ğŸ‡®ğŸ‡³ Central Government</option>
                <option value="Maharashtra">ğŸŸ  Maharashtra State</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold"><i class="fas fa-hand-holding-usd text-success me-1"></i>Support Type</label>
              <select class="form-select rounded-3" id="financialSupportType">
                <option value="">All Types</option>
                <option value="loan">Crop Loan / KCC</option>
                <option value="pension">Pension / Retirement</option>
                <option value="infrastructure">Infrastructure / Warehouse</option>
                <option value="subsidy">Subsidy / Grant</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold"><i class="fas fa-tractor text-success me-1"></i>Farmer Type</label>
              <select class="form-select rounded-3" id="financialFarmerType">
                <option value="">All Farmer Types</option>
                <option value="small">Small / Marginal Farmer</option>
                <option value="sharecropper">Sharecropper / Tenant</option>
                <option value="fpo">FPO / SHG Member</option>
                <option value="entrepreneur">Agri-Entrepreneur</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold"><i class="fas fa-birthday-cake text-success me-1"></i>Age Group</label>
              <select class="form-select rounded-3" id="financialAge">
                <option value="">Any Age</option>
                <option value="18to40">18 â€“ 40 years (Pension eligible)</option>
                <option value="above40">Above 40 years</option>
              </select>
            </div>
          </div>
          <div class="d-grid mt-4">
            <button type="submit" class="btn fw-bold py-2 rounded-pill fs-6 text-white"
              style="background:linear-gradient(135deg, #6eac72, #377c39);">
              ğŸ” Find Financial Schemes <i class="fas fa-arrow-right ms-1"></i>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODAL 3 â€“ INSURANCE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal fade" id="insuranceModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">
      <div class="modal-header text-white rounded-top-4" style="background:linear-gradient(135deg, #6eac72, #377c39);">
        <div>
          <h5 class="modal-title fw-bold mb-0">ğŸ›¡ï¸ Insurance Schemes</h5>
          <small class="opacity-75">Crop, life & accident insurance for farmers</small>
        </div>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-4">
        <form id="insuranceForm" novalidate>
          <div class="row g-3">

            <!-- NAME -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">
                <i class="fas fa-user text-primary me-1"></i>Farmer Name <span class="text-danger">*</span>
              </label>
              <input type="text" class="form-control rounded-3" id="insuranceFarmerName" placeholder="Enter your name">
              <div class="invalid-feedback"></div>
              <div class="valid-feedback">Looks good! âœ“</div>
            </div>

            <!-- LOCATION -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">
                <i class="fas fa-map-marker-alt text-primary me-1"></i>District <span class="text-danger">*</span>
              </label>
              <input type="text" class="form-control rounded-3" id="insuranceLocation" placeholder="e.g. Aurangabad">
              <div class="invalid-feedback"></div>
              <div class="valid-feedback">Looks good! âœ“</div>
            </div>

            <div class="col-md-6">
              <label class="form-label fw-semibold"><i class="fas fa-flag text-primary me-1"></i>Scheme Type <span class="text-danger">*</span></label>
              <select class="form-select rounded-3" id="insuranceType" required>
                <option value="All">All Schemes</option>
                <option value="Central">ğŸ‡®ğŸ‡³ Central Government</option>
                <option value="Maharashtra">Maharashtra State</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold"><i class="fas fa-shield-alt text-primary me-1"></i>Insurance Type</label>
              <select class="form-select rounded-3" id="insuranceCoverType">
                <option value="">All Insurance Types</option>
                <option value="crop">Crop / Fasal Bima</option>
                <option value="life">Life Insurance</option>
                <option value="calamity">Natural Calamity Relief</option>
                <option value="accident">Accident Insurance</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold"><i class="fas fa-seedling text-primary me-1"></i>Season</label>
              <select class="form-select rounded-3" id="insuranceSeason">
                <option value="">All Seasons</option>
                <option value="kharif">Kharif (June â€“ October)</option>
                <option value="rabi">Rabi (November â€“ March)</option>
                <option value="annual">Annual Crops</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold"><i class="fas fa-exclamation-triangle text-primary me-1"></i>Risk Type</label>
              <select class="form-select rounded-3" id="insuranceRisk">
                <option value="">Any Risk</option>
                <option value="drought">Drought</option>
                <option value="flood">Flood / Excess Rain</option>
                <option value="pest">Pest / Disease</option>
                <option value="death">Death / Accident</option>
              </select>
            </div>
          </div>
          <div class="d-grid mt-4">
            <button type="submit" class="btn fw-bold py-2 rounded-pill fs-6 text-white"
              style="background:linear-gradient(135deg, #6eac72, #377c39);">
              ğŸ” Find Insurance Schemes <i class="fas fa-arrow-right ms-1"></i>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>

  // â”€â”€ Load live stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  fetch('/api/schemes').then(r => r.json()).then(all => {
    document.getElementById('statTotal').textContent  = all.length + '+';
    document.getElementById('statActive').textContent = all.length + '+';
    document.getElementById('statGovt').textContent   = all.filter(s => s.category === 'govt').length + '+';
    document.getElementById('statFin').textContent    = all.filter(s => s.category === 'financial').length + '+';
    document.getElementById('statIns').textContent    = all.filter(s => s.category === 'insurance').length + '+';
  });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // VALIDATION HELPERS
  // Supports: English, Hindi (Devanagari), Marathi letters + spaces
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const NAME_REGEX = /^[a-zA-ZÃ€-Ã¿\u0900-\u097F\s]{2,50}$/;
  const LOC_REGEX  = /^[a-zA-ZÃ€-Ã¿\u0900-\u097F\s,.\-]{2,100}$/;

  function validateName(fieldId) {
    const field = document.getElementById(fieldId);
    const value = field.value.trim();
    if (!value) {
      return setInvalid(field, 'âš  Name is required.');
    }
    if (!NAME_REGEX.test(value)) {
      return setInvalid(field, 'âš  Letters only, 2â€“50 characters. No numbers or symbols.');
    }
    setValid(field);
    return true;
  }

  function validateLocation(fieldId) {
    const field = document.getElementById(fieldId);
    const value = field.value.trim();
    if (!value) {
      return setInvalid(field, 'âš  District / Village is required.');
    }
    if (!LOC_REGEX.test(value)) {
      return setInvalid(field, 'âš  Letters only, 2â€“100 characters. No numbers or special symbols.');
    }
    setValid(field);
    return true;
  }

  function setInvalid(field, message) {
    field.classList.remove('is-valid');
    field.classList.add('is-invalid');
    const fb = field.parentElement.querySelector('.invalid-feedback');
    if (fb) fb.textContent = message;
    return false;
  }

  function setValid(field) {
    field.classList.remove('is-invalid');
    field.classList.add('is-valid');
    return true;
  }

  function resetField(field) {
    field.value = '';
    field.classList.remove('is-valid', 'is-invalid');
    const fb = field.parentElement.querySelector('.invalid-feedback');
    if (fb) fb.textContent = '';
  }

  // â”€â”€ Real-time validation as user types â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.addEventListener('DOMContentLoaded', function () {

    // Govt form
    document.getElementById('farmerName')
      .addEventListener('input', () => validateName('farmerName'));
    document.getElementById('farmerLocation')
      .addEventListener('input', () => validateLocation('farmerLocation'));

    // Financial form
    document.getElementById('financialFarmerName')
      .addEventListener('input', () => validateName('financialFarmerName'));
    document.getElementById('financialLocation')
      .addEventListener('input', () => validateLocation('financialLocation'));

    // Insurance form
    document.getElementById('insuranceFarmerName')
      .addEventListener('input', () => validateName('insuranceFarmerName'));
    document.getElementById('insuranceLocation')
      .addEventListener('input', () => validateLocation('insuranceLocation'));

    // â”€â”€ Reset fields + validation state when modal closes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.querySelectorAll('.modal').forEach(function (modal) {
      modal.addEventListener('hidden.bs.modal', function () {
        modal.querySelectorAll('input[type="text"]').forEach(resetField);
        modal.querySelectorAll('select').forEach(function (sel) {
          sel.selectedIndex = 0;
          sel.classList.remove('is-valid', 'is-invalid');
        });
      });
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FORM SUBMIT HANDLERS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    // â”€â”€ GOVT SCHEME FORM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('schemeForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const nameOk = validateName('farmerName');
      const locOk  = validateLocation('farmerLocation');
      if (!nameOk || !locOk) return; // stop if invalid

      const params = new URLSearchParams();
      params.set('type',       document.getElementById('schemeType').value);
      params.set('farmerType', document.getElementById('schemefarmerType').value);
      params.set('cropNeed',   document.getElementById('schemeCropNeed').value);
      params.set('land',       document.getElementById('schemeLand').value);
      params.set('farmer',     document.getElementById('farmerName').value.trim());
      params.set('location',   document.getElementById('farmerLocation').value.trim());
      window.location.href = '/govscheme?' + params.toString();
    });

    // â”€â”€ FINANCIAL FORM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('financialForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const nameOk = validateName('financialFarmerName');
      const locOk  = validateLocation('financialLocation');
      if (!nameOk || !locOk) return;

      const params = new URLSearchParams();
      params.set('type',        document.getElementById('financialType').value);
      params.set('supportType', document.getElementById('financialSupportType').value);
      params.set('farmerType',  document.getElementById('financialFarmerType').value);
      params.set('age',         document.getElementById('financialAge').value);
      params.set('farmer',      document.getElementById('financialFarmerName').value.trim());
      params.set('location',    document.getElementById('financialLocation').value.trim());
      window.location.href = '/financial?' + params.toString();
    });

    // â”€â”€ INSURANCE FORM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('insuranceForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const nameOk = validateName('insuranceFarmerName');
      const locOk  = validateLocation('insuranceLocation');
      if (!nameOk || !locOk) return;

      const params = new URLSearchParams();
      params.set('type',      document.getElementById('insuranceType').value);
      params.set('coverType', document.getElementById('insuranceCoverType').value);
      params.set('season',    document.getElementById('insuranceSeason').value);
      params.set('risk',      document.getElementById('insuranceRisk').value);
      params.set('farmer',    document.getElementById('insuranceFarmerName').value.trim());
      params.set('location',  document.getElementById('insuranceLocation').value.trim());
      window.location.href = '/insurance?' + params.toString();
    });

  }); // end DOMContentLoaded

</script>
{% endblock %}